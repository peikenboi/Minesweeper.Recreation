<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minesweeper</title>

<style>
body{
  margin:0;
  background:#008080;
  font-family:Tahoma, Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#game{
  background:#c0c0c0;
  padding:8px;
  border:3px solid #fff;
  border-right-color:#7b7b7b;
  border-bottom-color:#7b7b7b;
  position:relative;
}

#header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
  padding:4px;
  background:#bdbdbd;
  border:2px solid #7b7b7b;
}

.counter{
  background:black;
  color:red;
  font-family:"Courier New", monospace;
  font-size:18px;
  padding:2px 6px;
  min-width:50px;
  text-align:center;
}

#smiley{
  width:32px;
  height:32px;
  background:#ffff00;
  border:2px solid #7b7b7b;
  border-top-color:#fff;
  border-left-color:#fff;
  position:relative;
  cursor:pointer;
}

.eye{width:4px;height:4px;background:black;position:absolute;top:9px}
.eye.left{left:8px}
.eye.right{right:8px}
.mouth{
  width:14px;
  height:6px;
  border-bottom:2px solid black;
  position:absolute;
  bottom:8px;
  left:9px;
}
#smiley.dead .mouth{border-bottom:none;border-top:2px solid black}
#smiley.win .mouth{border-bottom:3px solid black}

#menuBtn{
  margin-bottom:6px;
  width:100%;
}

.grid{
  display:grid;
  gap:2px;
  background:#7b7b7b;
  padding:3px;
}

.cell{
  width:26px;
  height:26px;
  background:#c0c0c0;
  border:2px solid #fff;
  border-right-color:#7b7b7b;
  border-bottom-color:#7b7b7b;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  cursor:pointer;
}

.cell.revealed{
  background:#bdbdbd;
  border:1px solid #7b7b7b;
  cursor:default;
}

.overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}

.popup{
  background:#c0c0c0;
  padding:16px;
  border:3px solid #fff;
  border-right-color:#7b7b7b;
  border-bottom-color:#7b7b7b;
  text-align:center;
}
.popup button{margin-top:10px}
</style>
</head>

<body>

<div id="game">

<button id="menuBtn">Menu</button>

<div id="header">
  <div class="counter" id="mineCounter">000</div>
  <div id="smiley">
    <div class="eye left"></div>
    <div class="eye right"></div>
    <div class="mouth"></div>
  </div>
  <div class="counter" id="timer">000</div>
</div>

<div class="grid" id="grid"></div>

<div class="overlay" id="menu">
  <div class="popup">
    <h3>Settings</h3>
    <label>Rows <input id="rows" type="number" value="9"></label><br>
    <label>Cols <input id="cols" type="number" value="9"></label><br>
    <label>Mines % <input id="chance" type="number" value="12"></label><br>
    <label>Background <input id="bg" type="color" value="#008080"></label><br>
    <button onclick="applySettings()">Apply</button>
  </div>
</div>

<div class="overlay" id="endScreen">
  <div class="popup">
    <h2 id="endText"></h2>
    <button onclick="init()">Restart</button>
  </div>
</div>

</div>

<script>
let rows=9,cols=9,mineChance=12;
let grid=document.getElementById("grid");
let cells=[],mines=new Set(),flags=new Set(),revealed=new Set();
let firstClick=true,gameOver=false;
let timer=0,timerInt;

function idx(r,c){return r*cols+c}
function neighbors(r,c){
  let a=[];
  for(let dr=-1;dr<=1;dr++)
    for(let dc=-1;dc<=1;dc++)
      if(dr||dc){
        let nr=r+dr,nc=c+dc;
        if(nr>=0&&nr<rows&&nc>=0&&nc<cols)a.push([nr,nc]);
      }
  return a;
}

function placeMinesSafe(r,c){
  let safe=new Set([idx(r,c)]);
  neighbors(r,c).forEach(p=>safe.add(idx(...p)));
  for(let i=0;i<rows*cols;i++)
    if(!safe.has(i)&&Math.random()*100<mineChance)mines.add(i);
  updateCounter();
}

function reveal(r,c){
  let i=idx(r,c);
  if(revealed.has(i)||flags.has(i)||gameOver)return;
  if(firstClick){placeMinesSafe(r,c);startTimer();firstClick=false}
  revealed.add(i);
  let cell=cells[i];
  cell.classList.add("revealed");
  if(mines.has(i)){end(false);return}
  let n=neighbors(r,c).filter(p=>mines.has(idx(...p))).length;
  if(n)cell.textContent=n;
  else neighbors(r,c).forEach(p=>reveal(...p));
  if(revealed.size===rows*cols-mines.size)end(true);
}

function flag(i){
  if(revealed.has(i)||gameOver)return;
  flags.has(i)?flags.delete(i):flags.add(i);
  cells[i].textContent=flags.has(i)?"F":"";
  updateCounter();
}

function updateCounter(){
  document.getElementById("mineCounter").textContent=
    String(Math.max(0,mines.size-flags.size)).padStart(3,"0");
}

function startTimer(){
  timerInt=setInterval(()=>{
    timer++;
    document.getElementById("timer").textContent=String(timer).padStart(3,"0");
  },1000);
}

function end(win){
  gameOver=true;
  clearInterval(timerInt);
  document.getElementById("smiley").className=win?"win":"dead";
  document.getElementById("endText").textContent=win?"You Win!":"Game Over";
  document.getElementById("endScreen").style.display="flex";
}

function init(){
  grid.innerHTML="";
  cells=[];mines.clear();flags.clear();revealed.clear();
  firstClick=true;gameOver=false;timer=0;
  clearInterval(timerInt);
  document.getElementById("timer").textContent="000";
  document.getElementById("mineCounter").textContent="000";
  document.getElementById("endScreen").style.display="none";
  document.getElementById("smiley").className="";
  grid.style.gridTemplateColumns=`repeat(${cols},26px)`;

  for(let r=0;r<rows;r++)
    for(let c=0;c<cols;c++){
      let d=document.createElement("div");
      d.className="cell";
      let i=idx(r,c);
      d.onclick=()=>reveal(r,c);
      d.oncontextmenu=e=>{e.preventDefault();flag(i)};
      grid.appendChild(d);
      cells.push(d);
    }
}

function applySettings(){
  rows=+rows.value;
  cols=+cols.value;
  mineChance=+chance.value;
  document.body.style.background=bg.value;
  menu.style.display="none";
  init();
}

menuBtn.onclick=()=>menu.style.display="flex";
smiley.onclick=init;
init();
</script>

</body>
</html>
